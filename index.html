<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Textastic ¬∑ Web Code Editor</title>
    <!-- Monaco editor loader from CDN -->
    <script src="https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs/loader.js"></script>
    <style>
        /* ---------- RESET & PROFESSIONAL DARK THEME ‚Äî TEXTISTIC INSPIRED ---------- */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'SF Mono', 'Menlo', 'Monaco', 'Cascadia Code', 'Consolas', 'Courier New', monospace;
        }

        html, body {
            height: 100%;
            width: 100%;
            background-color: #1e1e1e;
            overflow: hidden;
            color: #e0e0e0;
        }

        /* ----- MAIN FLEX LAYOUT (CLEAN, AIRY, NO OVERCROWDING) ----- */
        .app {
            display: flex;
            flex-direction: column;
            height: 100vh;
            width: 100vw;
            background-color: #1e1e1e;
        }

        /* ---------- TOP BAR ‚Äî ELEGANT, SPACIOUS ---------- */
        .toolbar {
            flex-shrink: 0;
            background: #2d2d30;
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 20px;
            border-bottom: 1px solid #3e3e42;
            box-shadow: 0 2px 6px rgba(0,0,0,0.4);
            z-index: 10;
        }
        .toolbar button {
            background: #0e6c9e;
            border: none;
            color: white;
            padding: 10px 22px;
            font-size: 14px;
            font-weight: 500;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.15s ease;
            letter-spacing: 0.4px;
            border: 1px solid rgba(255,255,255,0.1);
            display: flex;
            align-items: center;
            gap: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .toolbar button:hover {
            background: #1188c4;
            border-color: rgba(255,255,255,0.3);
        }
        .toolbar button:active {
            background: #0a4f7a;
            transform: translateY(1px);
        }
        #current-folder-indicator {
            color: #c0c0c0;
            font-size: 14px;
            margin-left: 10px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            padding: 6px 14px;
            background: #252526;
            border-radius: 5px;
            border-left: 3px solid #0e6c9e;
            flex: 1;
            max-width: 400px;
        }

        /* ---------- MAIN ROW (EXPLORER + EDITOR) PERFECT PROPORTIONS ---------- */
        .main {
            display: flex;
            flex: 1;
            min-height: 0;
            background: #1e1e1e;
        }

        /* ---------- LEFT PANEL ‚Äî FILE EXPLORER (TEXTISTIC STYLE) ---------- */
        .explorer {
            width: 320px;
            background: #252526;
            border-right: 1px solid #3e3e42;
            display: flex;
            flex-direction: column;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 2px 0 8px rgba(0,0,0,0.3);
        }
        .explorer-header {
            padding: 16px 20px;
            font-size: 13px;
            text-transform: uppercase;
            font-weight: 700;
            letter-spacing: 1.5px;
            color: #aaa;
            background: #2a2a2c;
            border-bottom: 1px solid #3e3e42;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #tree-container {
            flex: 1;
            overflow-y: auto;
            padding: 16px 0 20px 12px;
            background: #252526;
        }
        /* --- Tree structure ‚Äî clean, collapsible, file icons --- */
        .tree {
            list-style: none;
            padding-left: 0;
            margin: 0;
            font-size: 13.5px;
        }
        .tree ul {
            list-style: none;
            padding-left: 20px;
            margin-left: 6px;
            border-left: 1px dashed #4a4a4a;
        }
        .tree li {
            margin: 5px 0;
            line-height: 1.6;
        }
        .folder-name {
            cursor: pointer;
            color: #e8e8e8;
            display: inline-flex;
            align-items: center;
            padding: 6px 12px 6px 8px;
            border-radius: 4px;
            width: fit-content;
            transition: background 0.1s;
            font-weight: 500;
            user-select: none;
        }
        .folder-name:hover {
            background: #3a3a3e;
        }
        .folder-name::before {
            content: "üìÅ  ";
            font-size: 14px;
            margin-right: 6px;
            color: #c49e5c;
        }
        .file-item {
            cursor: pointer;
            padding: 6px 12px 6px 36px;
            border-radius: 4px;
            color: #d4d4d4;
            display: flex;
            align-items: center;
            position: relative;
            transition: all 0.1s;
            white-space: nowrap;
        }
        .file-item:hover {
            background: #3a3a3e;
            color: white;
        }
        .file-item::before {
            content: "üìÑ  ";
            position: absolute;
            left: 14px;
            font-size: 14px;
            color: #b0b0b0;
        }
        .hidden {
            display: none !important;
        }
        .empty-tree-message {
            color: #888;
            padding: 24px;
            text-align: center;
            font-style: italic;
            letter-spacing: 0.5px;
        }

        /* ---------- CENTER: MONACO EDITOR ‚Äî PERFECT FIT ---------- */
        .editor-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            background: #1e1e1e;
            position: relative;
            overflow: hidden;
            border-left: 1px solid #2d2d2d;
        }
        #editor {
            width: 100%;
            height: 100%;
            min-height: 0;
        }

        /* ---------- BOTTOM: TERMINAL ‚Äî SIMULATED, BUT LOOKS 100% REAL ---------- */
        .terminal-panel {
            flex-shrink: 0;
            height: 240px;
            background: #1a1a1c;
            border-top: 2px solid #3e3e42;
            display: flex;
            flex-direction: column;
            color: #cccccc;
            font-family: 'Consolas', 'Monaco', monospace;
            font-size: 13px;
            box-shadow: 0 -4px 10px rgba(0,0,0,0.2);
        }
        .terminal-header {
            background: #2d2d30;
            padding: 8px 22px;
            font-weight: 600;
            color: #d4d4d4;
            border-bottom: 1px solid #4a4a4a;
            display: flex;
            align-items: center;
            gap: 8px;
            text-transform: uppercase;
            font-size: 12px;
            letter-spacing: 1px;
        }
        .terminal-output {
            flex: 1;
            overflow-y: auto;
            padding: 14px 22px;
            background: #1a1a1c;
            line-height: 1.7;
            display: flex;
            flex-direction: column;
        }
        .terminal-line {
            color: #b3e6b3;
            white-space: pre-wrap;
            word-break: break-all;
            border-bottom: 1px solid #2a2a2a;
            padding: 4px 0;
            font-family: 'Consolas', 'Monaco', monospace;
        }
        .terminal-line.error {
            color: #f48771;
            background: #2d1a1a;
            padding-left: 8px;
            border-left: 4px solid #f44;
        }
        .terminal-line.info {
            color: #9cdcfe;
        }
        .timestamp {
            color: #6a9955;
            margin-right: 18px;
            font-weight: 500;
        }
        /* ---------- SCROLLBARS (CLEAN) ---------- */
        ::-webkit-scrollbar { width: 10px; height: 10px; }
        ::-webkit-scrollbar-track { background: #1e1e1e; }
        ::-webkit-scrollbar-thumb { background: #4a4a4a; border-radius: 6px; }
        ::-webkit-scrollbar-thumb:hover { background: #6a6a6a; }
    </style>
</head>
<body>
    <div class="app">
        <!-- TOP TOOLBAR ‚Äî OPEN FOLDER & SAVE, CLEAN STATUS -->
        <div class="toolbar">
            <button id="openFolderBtn">
                <span style="font-size:16px;">üìÇ</span> OPEN FOLDER
            </button>
            <button id="saveBtn">
                <span style="font-size:16px;">üíæ</span> SAVE
            </button>
            <span id="current-folder-indicator">‚è∫ no active folder</span>
        </div>

        <!-- MAIN WORKSPACE: EXPLORER + MONACO -->
        <div class="main">
            <!-- LEFT: FILE TREE (TEXTISTIC DARK) -->
            <div class="explorer">
                <div class="explorer-header">
                    <span>üìÅ WORKSPACE</span>
                    <span style="color:#888;font-size:11px;">FILES</span>
                </div>
                <div id="tree-container">
                    <div class="empty-tree-message">‚óá open a folder to browse files</div>
                </div>
            </div>

            <!-- CENTER: MONACO EDITOR (VS DARK) -->
            <div class="editor-container">
                <div id="editor"></div>
            </div>
        </div>

        <!-- BOTTOM: SIMULATED TERMINAL ‚Äî PROFESSIONAL LOGGING -->
        <div class="terminal-panel">
            <div class="terminal-header">
                <span>‚¨¢ TERMINAL</span>
                <span style="color:#888; font-weight:400; margin-left:auto;">simulated ‚Äî double‚Äëclick header clear</span>
            </div>
            <div id="terminal-output" class="terminal-output">
                <div class="terminal-line"><span class="timestamp">‚ö°</span> Textastic ‚Ä¢ ready ¬∑ open a folder (Chrome/Edge desktop)</div>
            </div>
        </div>
    </div>

    <script>
        (function(){
            "use strict";

            // ---------- PROFESSIONAL STATE ‚Äî NO SIMULATION, REAL FILES ----------
            let editor;
            let editorReady = false;
            let currentFileHandle = null;
            let currentDirectoryHandle = null;
            let fileHandleMap = new Map();  // optional but robust

            // DOM elements
            const treeContainer = document.getElementById('tree-container');
            const terminalOutput = document.getElementById('terminal-output');
            const folderIndicator = document.getElementById('current-folder-indicator');
            const openFolderBtn = document.getElementById('openFolderBtn');
            const saveBtn = document.getElementById('saveBtn');

            // ---------- MONACO INIT (VS DARK, PROFESSIONAL) ----------
            function initMonaco() {
                require.config({ paths: { vs: 'https://cdn.jsdelivr.net/npm/monaco-editor@0.34.1/min/vs' } });
                require(['vs/editor/editor.main'], function() {
                    editor = monaco.editor.create(document.getElementById('editor'), {
                        value: '// select or create a file from the explorer',
                        language: 'plaintext',
                        theme: 'vs-dark',
                        automaticLayout: true,
                        wordWrap: 'on',
                        fontSize: 14,
                        fontFamily: 'SF Mono, Monaco, "Cascadia Code", Consolas, monospace',
                        minimap: { enabled: true, scale: 1 },
                        scrollBeyondLastLine: false,
                        lineNumbers: 'on',
                        renderWhitespace: 'selection',
                        bracketPairColorization: { enabled: true },
                        fontSize: 14,
                        padding: { top: 16 }
                    });
                    editorReady = true;
                    logTerminal('‚úÖ Monaco editor loaded ‚Äî vs‚Äëdark', 'info');
                });
            }

            // ---------- TERMINAL LOG (REAL FEEDBACK, NOT FAKE) ----------
            function logTerminal(message, type = 'info') {
                const line = document.createElement('div');
                line.className = 'terminal-line ' + (type === 'error' ? 'error' : 'info');
                const now = new Date();
                const timeStr = `[${now.getHours().toString().padStart(2,'0')}:${now.getMinutes().toString().padStart(2,'0')}:${now.getSeconds().toString().padStart(2,'0')}]`;
                line.innerHTML = `<span class="timestamp">${timeStr}</span> ${message}`;
                terminalOutput.appendChild(line);
                terminalOutput.scrollTop = terminalOutput.scrollHeight;
                // keep max 200 lines for performance
                while (terminalOutput.children.length > 200) {
                    terminalOutput.removeChild(terminalOutput.children[0]);
                }
            }

            // ---------- DETECT LANGUAGE FROM EXTENSION ----------
            function getLanguageFromExtension(filename) {
                const ext = filename.slice(filename.lastIndexOf('.')).toLowerCase();
                const langMap = {
                    '.js': 'javascript', '.ts': 'typescript', '.jsx': 'javascript', '.tsx': 'typescript',
                    '.html': 'html', '.htm': 'html', '.css': 'css', '.scss': 'scss', '.less': 'less',
                    '.json': 'json', '.xml': 'xml', '.yaml': 'yaml', '.yml': 'yaml',
                    '.md': 'markdown', '.py': 'python', '.rb': 'ruby', '.php': 'php',
                    '.java': 'java', '.c': 'c', '.cpp': 'cpp', '.h': 'cpp', '.cs': 'csharp',
                    '.go': 'go', '.rs': 'rust', '.swift': 'swift', '.kt': 'kotlin',
                    '.sh': 'shell', '.bash': 'shell', '.bat': 'bat', '.ps1': 'powershell',
                    '.sql': 'sql', '.txt': 'plaintext', '.log': 'plaintext',
                    '.toml': 'plaintext', '.ini': 'ini', '.cfg': 'ini',
                    '.vue': 'html', '.svelte': 'html', '.astro': 'html'
                };
                return langMap[ext] || 'plaintext';
            }

            // ---------- OPEN FILE (REAL, FROM HANDLE) ----------
            async function openFileFromHandle(fileHandle, domElement) {
                if (!editorReady) {
                    logTerminal('‚åõ editor still loading ‚Äî please wait', 'error');
                    return;
                }
                try {
                    const file = await fileHandle.getFile();
                    const content = await file.text();
                    editor.setValue(content);
                    currentFileHandle = fileHandle;
                    const lang = getLanguageFromExtension(fileHandle.name);
                    monaco.editor.setModelLanguage(editor.getModel(), lang);
                    logTerminal(`üìÇ opened: ${fileHandle.name} (${lang})`, 'info');
                    folderIndicator.textContent = `üìÅ ${currentDirectoryHandle?.name || ''} ¬∑ ${fileHandle.name}`;
                } catch (err) {
                    logTerminal(`‚ùå error opening file: ${err.message}`, 'error');
                }
            }

            // ---------- SAVE CURRENT FILE (REAL OVERWRITE) ----------
            async function saveCurrentFile() {
                if (!currentFileHandle) {
                    logTerminal('‚ö† no file open ‚Äî use save on an opened file', 'error');
                    return;
                }
                if (!editorReady) return;
                try {
                    const content = editor.getValue();
                    const writable = await currentFileHandle.createWritable();
                    await writable.write(content);
                    await writable.close();
                    logTerminal(`üíæ saved: ${currentFileHandle.name}`, 'info');
                } catch (err) {
                    logTerminal(`‚ùå save failed: ${err.message}`, 'error');
                }
            }

            // ---------- RECURSIVE DIRECTORY TRAVERSAL (PERFECT TREE) ----------
            async function buildTree(dirHandle, parentUl, path) {
                for await (const entry of dirHandle.values()) {
                    const li = document.createElement('li');
                    if (entry.kind === 'directory') {
                        // folder item
                        const folderSpan = document.createElement('span');
                        folderSpan.className = 'folder-name';
                        folderSpan.textContent = entry.name;
                        li.appendChild(folderSpan);
                        const childUl = document.createElement('ul');
                        childUl.classList.add('tree', 'nested');
                        li.appendChild(childUl);
                        parentUl.appendChild(li);
                        await buildTree(entry, childUl, path + entry.name + '/');
                    } else {
                        // file item
                        li.className = 'file-item';
                        li.textContent = entry.name;
                        li.fileHandle = entry;     // store handle directly on DOM
                        li.dataset.path = path + entry.name;
                        parentUl.appendChild(li);
                    }
                }
            }

            // ---------- OPEN FOLDER USING FILE SYSTEM ACCESS API (REAL) ----------
            async function openFolder() {
                if (!window.showDirectoryPicker) {
                    logTerminal('‚ùå FILE SYSTEM ACCESS API NOT SUPPORTED ‚Äî use Chrome/Edge desktop (HTTPS/localhost)', 'error');
                    return;
                }
                try {
                    const dirHandle = await window.showDirectoryPicker();
                    currentDirectoryHandle = dirHandle;
                    folderIndicator.textContent = `üìÅ ${dirHandle.name}`;
                    logTerminal(`üìÇ folder opened: ${dirHandle.name}`, 'info');

                    // reset tree and current file
                    treeContainer.innerHTML = '';
                    currentFileHandle = null;
                    editor.setValue('// select a file from the explorer');
                    monaco.editor.setModelLanguage(editor.getModel(), 'plaintext');

                    const rootUl = document.createElement('ul');
                    rootUl.className = 'tree';
                    await buildTree(dirHandle, rootUl, '');
                    treeContainer.appendChild(rootUl);

                    if (rootUl.children.length === 0) {
                        treeContainer.innerHTML = '<div class="empty-tree-message">üìÅ folder is empty</div>';
                    }
                } catch (err) {
                    if (err.name !== 'AbortError') {
                        logTerminal(`‚ùå folder open error: ${err.message}`, 'error');
                    }
                }
            }

            // ---------- EVENT DELEGATION (COLLAPSE / FILE CLICK) ----------
            function attachTreeEvents() {
                treeContainer.addEventListener('click', async (e) => {
                    // folder collapse/expand
                    const folder = e.target.closest('.folder-name');
                    if (folder) {
                        e.stopPropagation();
                        const parentLi = folder.closest('li');
                        const childUl = parentLi.querySelector('ul');
                        if (childUl) childUl.classList.toggle('hidden');
                        return;
                    }
                    // file click
                    const fileItem = e.target.closest('.file-item');
                    if (fileItem && fileItem.fileHandle) {
                        e.preventDefault();
                        await openFileFromHandle(fileItem.fileHandle, fileItem);
                    }
                });
            }

            // ---------- DOUBLE-CLICK TERMINAL HEADER CLEAR ----------
            document.querySelector('.terminal-header').addEventListener('dblclick', function() {
                terminalOutput.innerHTML = '<div class="terminal-line"><span class="timestamp">‚ö°</span> terminal cleared</div>';
            });

            // ---------- WARN IF API MISSING (BUTTON STILL WORKS) ----------
            if (!window.showDirectoryPicker) {
                logTerminal('‚ö† File System Access API unavailable ‚Äî this app requires Chrome/Edge desktop', 'error');
            }

            // ---------- INITIALISE ----------
            initMonaco();
            openFolderBtn.addEventListener('click', openFolder);
            saveBtn.addEventListener('click', saveCurrentFile);
            attachTreeEvents();

            // ---------- PROFESSIONAL TOUCH: DRAG FILE? (not required but graceful) ----------
            // no drag, pure file system api ‚Äî exactly like Textastic
        })();
    </script>

    <!--
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
        TEXTISTIC ¬∑ PROFESSIONAL WEB CODE EDITOR
        ‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî‚Äî
        ‚úì Monaco editor (vs‚Äëdark) from CDN
        ‚úì Real File System Access API ‚Äî no simulation
        ‚úì Open folder ‚Üí full recursive tree, collapsible
        ‚úì Click file ‚Üí open in editor, language detection
        ‚úì Save button ‚Üí overwrite original file
        ‚úì Terminal logs real operations (simulated UI, real events)
        ‚úì Pure vanilla JS, one HTML file, Chrome/Edge desktop only
        ‚úì UI inspired by Textastic: spacious, clean, dark
        ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    -->
</body>
</html>
